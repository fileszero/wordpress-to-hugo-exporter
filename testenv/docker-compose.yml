version: '3.3'

# https://docs.docker.com/compose/wordpress/
# http://docs.docker.jp/compose/wordpress.html
# docker-compose up -d
# then access http://localhost:8000
#             user: hugo pw:hugo
# export setting
# docker exec -it testenv_db_1 sh -c 'mysqldump wordpress -u wordpress -pwordpress 2> /dev/null' > mysql.dump.sql
services:
   db:
     image: mysql:5.7
     volumes:
       - ./.data/db:/var/lib/mysql
       - ./mysql.dump.sql:/docker-entrypoint-initdb.d/install_wordpress.sql
     restart: always
     environment:
       MYSQL_ROOT_PASSWORD: somewordpress
       MYSQL_DATABASE: wordpress
       MYSQL_USER: wordpress
       MYSQL_PASSWORD: wordpress

   wordpress:
     depends_on:
       - db
     build: ./wp
     ports:
       - "8000:80"
      #  - "9001:9001"  # XDebug # あると動かないっぽい
     restart: always
     volumes:
       - ./wp/xdebug.ini:/usr/local/etc/php/conf.d/xdebug.ini
       - ./wp/uploadsize.ini:/usr/local/etc/php/conf.d/uploadsize.ini
       - ./src:/var/www/html/test/
       - ./tmp/:/tmp/
       - ../:/var/www/html/wp-content/plugins/hugo-export/
       - ./uploads:/var/www/html/wp-content/uploads/
     environment:
       WORDPRESS_DB_HOST: db:3306
       WORDPRESS_DB_USER: wordpress
       WORDPRESS_DB_PASSWORD: wordpress
       WORDPRESS_DB_NAME: wordpress

